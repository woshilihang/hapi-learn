# 基于hapi的Node.js小程序后端开发实践指南

## API接口服务化的设计哲学

* 调试工具与技巧
* 后端基础打底框架
* 脱离版本库的环境参数配置
* 一致化的HTTP response返回
* 入参校验
* 数据库ORM
* 基于JWT的用户身份验证
* 数据缓存
* 日志系统
* 单元测试
* 接口文档

## 业务需求分析与基础设计

* 用户身份的建立
* 服务接口针对用户的验证
* 获取列表类数据
* 分页列表数据
* 获取单条数据详情
* 提交业务数据

用户鉴权 & 业务的增删改查(CURD)


用户验证的流程先后问题

新闻媒体流
中后台管理系统

#### 案例实现的目标业务流程

用户访问店铺列表
展示店铺 名称、图标 URL
用户访问目标店铺的商品列表
展示商品名称、图标 URL、商品单价
用户授权登录
获取用户姓名、openid、性别
选择需要选购的商品与数量
创建购物订单
创建支付订单
支付订单
完成订单

一个用于支撑小程序外卖业务的后端系统，

推崇配置优于代码的原则

supervisor | nodemon | pm2

node --inspect app.js
chrome://inspect 

约定形成一套良好的模块化文件结构与规范

项目工程化设计原则
    但业务模块化
    模块二百行原则
    同类模块分组化
    配置文件分离

接口文档化
hapi-swagger & Joi。
hapi-swagger 接口描述，为REST APIS定义一个标准的可视化文档
Joi一种验证模块

#### 使用Joi校验数据结构

适合动态领路由的params验证
适合POST接口的payload(request body)验证
适合GET接口的query（URL路径参数）
适合header额外字段约束的headers验证


#### 待解决的疑问点
如何处理每个接口入参错误返回提示语message, 即使同个入参都需要提示不一样的message
如何统一加authorization，类似于拦截器，避免每个接口都加
服务器端部署

### 表结构设计、迁移与数据填充 - 使用Sequelize-cli
数据库的连接创建
表结构的初始化
起始数据的填充


店铺表： 展示店铺名称，图标URL
